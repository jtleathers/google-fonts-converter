<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Fonts Converter to Variable Fonts</title>
    <link rel="stylesheet" href="normalize.css">
</head>
<body>

    <h1>Google Fonts Converter to Variable Fonts</h1>
    <p>Convert your Google Fonts URL to use the variable font files instead. This will only work if the Google Font has variable fonts.</p>

    <form id="urlForm">
        <label for="urlInput">Enter Google Fonts URL:</label>
        <br><input type="text" id="urlInput" required style="width: 100%; display: block;">
        <button type="button" onclick="replaceText()">Convert</button>
    </form>

    <h2>Updated URL</h2>
    <p id="result"></p>

    <h2>Updated Link Tags</h2>
    <code id="result-code"></code>

    <script>
        function replaceText() {

            function filterAndExtractMinMax(arr, targetValue) {
                // Filter the arrays where the first value matches the target value
                var filteredArray = arr.filter(function(subarray) {
                    return subarray[0] === targetValue;
                });
                
                // Find the minimum and maximum values in the filtered array
                var minValue = Math.min.apply(null, filteredArray.map(function(subarray) {
                    return subarray[1];
                }));
                
                var maxValue = Math.max.apply(null, filteredArray.map(function(subarray) {
                    return subarray[1];
                }));

                // Create a new array with only the minimum and maximum values
                var resultArray = [minValue, maxValue];

                // Convert the array to a string representation
                return resultArray.join('..');
            }

            // Get the input value
            var url = document.getElementById("urlInput").value;

            // Use a regular expression to find all occurrences of "family="
            var matches = url.match(/family=[^&]*/g);

            // Check if matches is not null (i.e., "family=" was found) and if it has more than 2 font families
            if ( matches !== null && matches.length >= 2 ) {

                // Extract everything from "family=" until the next "&"
                var fontFamiliesArray = matches.map(function(match) {
                    var modifiedURL = match.substring(7); // Remove "family="
                    var parts = modifiedURL.split('@');
                    return [parts[0] + '@', parts.slice(1).join('@')];
                });

                var newURL = '';
                
                // Loop through each font family
                fontFamiliesArray.forEach((fontFamily) => {

                    // Grab the weights of the font family
                    var fontFamilyWeights = fontFamily[1];

                    // Build an array and convert strings to numbers
                    var textToArray2 = fontFamilyWeights.split(';').map(function(item) {
                        return item.split(',').map(function(value) {
                            return parseInt(value, 10);
                        });
                    });

                    // Replace the current weights array with this new array
                    fontFamily[1] = textToArray2;

                    // Check if the font family has both normal and italic weights
                    if ( fontFamily[1][0].length > 1 ) {
                        // Normal AND Italic 
                        var resultStringForZero2 = filterAndExtractMinMax(fontFamily[1], 0);
                        var resultStringForOne2 = filterAndExtractMinMax(fontFamily[1], 1);
                        
                        var combined3 = 'family=' + fontFamily[0] + '0,' + resultStringForZero2 + ';' + '1,' + resultStringForOne2 + '&';

                        newURL += combined3;

                    } else {
                        // Normal OR Italic 
                        var flattenedArray2 = fontFamily[1].map(function(subarray) {
                            return subarray[0];
                        });

                        // Find the minimum and maximum values
                        var minValue = Math.min.apply(null, flattenedArray2);
                        var maxValue = Math.max.apply(null, flattenedArray2);

                        // Create a new array with only the minimum and maximum values
                        var resultArray2 = [minValue, maxValue];

                        var resultString2 = resultArray2.join('..');
                        
                        var combined2 = 'family=' + fontFamily[0] + resultString2 + '&';

                        newURL += combined2;

                    }

                });

                newURL = newURL + 'display=swap';
                
                var updatedURL2 = url.replace(/family=.*?&display=swap/, newURL);                
                
                // Display the resulting url
                document.getElementById("result").innerHTML = updatedURL2;

                // Display the resulting code
                document.getElementById("result-code").innerHTML = '&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;<br>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;<br>&lt;link href="' + updatedURL2 + '" rel="stylesheet"&gt;';

            } else if ( matches !== null && matches.length == 1 ) {
                // Check if matches is not null (i.e., "family=" was found) and if it has only 1 font family

                // Find everything between wght@ and &display
                var extractedText = url.match(/wght@([^&]*)\&display/g);
                
                // Remove wght@ and &display
                var modifiedText = extractedText[0].replace(/wght@/, '').replace(/&display/, '');

                // Build an array and convert strings to numbers
                var textToArray = modifiedText.split(';').map(function(item) {
                    return item.split(',').map(function(value) {
                        return parseInt(value, 10);
                    });
                });

                if ( textToArray[0].length > 1 ) {
                    // This is if both normal and italic are passed in url
                    var resultStringForZero = filterAndExtractMinMax(textToArray, 0);
                    var resultStringForOne = filterAndExtractMinMax(textToArray, 1);
                    
                    var combined = 'wght@0,' + resultStringForZero + ';1,' + resultStringForOne + '&display';
                } else {
                    // This is if only normal or italic are passed in url
                    var flattenedArray = textToArray.map(function(subarray) {
                        return subarray[0];
                    });

                    // Find the minimum and maximum values
                    var minValue = Math.min.apply(null, flattenedArray);
                    var maxValue = Math.max.apply(null, flattenedArray);

                    // Create a new array with only the minimum and maximum values
                    var resultArray = [minValue, maxValue];

                    var resultString = resultArray.join('..')
                    
                    var combined = 'wght@' + resultString + '&display';
                }

                // Search for the specified string in testURL and replace it with combined
                updatedURL = url.replace(/wght@.*?&display/, combined);

                // Display the resulting url
                document.getElementById("result").innerHTML = updatedURL;

                // Display the resulting code
                document.getElementById("result-code").innerHTML = '&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;<br>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;<br>&lt;link href="' + updatedURL + '" rel="stylesheet"&gt;';
            } else {
                // Display the result
                document.getElementById("result").innerHTML = "This is not a Google Fonts URL.";
            }

        }
    </script>

<h2>Multiple Font Familes with Italic and Normal</h2>
<p>original: https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,800;1,300;1,400;1,500;1,800&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap</p>
<p>updated: https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Playfair+Display:ital,wght@0,400..700;1,400..700&display=swap</p>

<h2>Multiple Font Familes with only Normal</h2>
<p>original: https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;700&family=Playfair+Display:wght@400;500;700&display=swap</p>
<p>updated: https://fonts.googleapis.com/css2?family=Open+Sans:wght@300..700&family=Playfair+Display:wght@400..700&display=swap</p>

<h2>One Font Family with Italic and Normal</h2>
<p>original: https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,800;1,300;1,400;1,500;1,800&display=swap</p>
<p>updated: https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap</p>

<h2>One Font Family with only Normal</h2>
<p>original: https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;800&display=swap</p>
<p>updated: https://fonts.googleapis.com/css2?family=Open+Sans:wght@300..800&display=swap</p>

</body>
</html>
